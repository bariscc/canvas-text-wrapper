!function(e){function t(t,i,r){"use strict";function o(e){L||(L=c.sizeToFill?u.font.split(/\b\d+px\b/i):c.font.split(/\b\d+px\b/i)),u.font=L[0]+e+"px"+L[1]}function n(e){o(e),D=e*c.lineHeight,a()}function a(){if(c.allowNewLine)for(var e=i.trim().split("\n"),t=0,r=0;t<e.length-1;t++)r+=e[t].trim().split(/\s+/).length,B.push(r);var o=i.trim().split(/\s+/);l(o),s(o),C=H.length*D}function l(e){var t,i,r,o;e.forEach(function(n,a){if(t="",(i=u.measureText(n).width)>N){for(var l=0;u.measureText(t+n[l]).width<=N&&l<n.length;l++)t+=n[l];r=n.slice(0,l),o=n.slice(l),e.splice(a,1,r,o)}})}function s(e){H=[];for(var t=0,i=0;t<e.length;i++)if(H[i]="","auto"===c.lineBreak){if(u.measureText(H[i]+e[t]).width>N)break;for(;u.measureText(H[i]+e[t]).width<=N&&t<e.length;)if(H[i]+=e[t]+" ",t++,c.allowNewLine)for(var r=0;r<B.length;r++)if(B[r]===t){H[++i]="";break}H[i]=H[i].trim()}else H[i]=e[t],t++}function f(){for(var e,t,i,r=0;r<H.length;r++)i=u.measureText(H[r]).width,(!e||i>e)&&(e=i,t=r);var o,n,a,l;for(r=0;r<H.length;r++)if(r!==t&&!((o=H[r].trim().split(/\s+/).length)<=1)){H[r]=H[r].trim().split(/\s+/).join(" "),n=u.measureText(" ").width,a=(e-u.measureText(H[r]).width)/n/(o-1),l="";for(var s=0;s<a;s++)l+=" ";H[r]=H[r].trim().split(" ").join(l)}}function p(e,t,i){var r=u.measureText(e).width;switch(u.textAlign){case"center":t-=r/2;break;case"right":t-=r}u.beginPath(),u.moveTo(t,i),u.lineTo(t+r,i),u.stroke()}function h(){for(var e=0;e<H.length;e++)F.y=parseInt(F.y)+D,u.fillText(H[e],F.x,F.y),c.strokeText&&u.strokeText(H[e],F.x,F.y),"underline"===c.textDecoration.toLocaleLowerCase()&&p(H[e],F.x,F.y)}function d(){u.textAlign=c.textAlign,"center"==c.textAlign?F.x=P/2:"right"==c.textAlign?F.x=P-c.paddingX:F.x=c.paddingX}function g(){"middle"==c.verticalAlign?F.y=(A-C)/2:"bottom"==c.verticalAlign?F.y=A-C-c.paddingY:F.y=c.paddingY}var w={font:"18px Arial, sans-serif",sizeToFill:!1,maxFontSizeToFill:!1,lineHeight:1,allowNewLine:!0,lineBreak:"auto",textAlign:"left",verticalAlign:"top",justifyLines:!1,paddingX:0,paddingY:0,fitParent:!1,strokeText:!1,renderHDPI:!0,textDecoration:"none",withExample:!0},c={};for(var x in w)c[x]=r.hasOwnProperty(x)?r[x]:w[x];var u=t.getContext("2d");u.font=c.font,u.textBaseline="bottom";var m=1,y="undefined"!=typeof global?global.devicePixelRatio:e.devicePixelRatio;if(c.renderHDPI&&y>1){var T={};for(var x in u)T[x]=u[x];var b=t.width,v=t.height;m=y,t.width=b*m,t.height=v*m,t.style.width=b*m*.5+"px",t.style.height=v*m*.5+"px";for(var x in T)try{u[x]=T[x]}catch(e){}u.scale(m,m)}var L,P=(c.fitParent?t.parentNode.clientWidth:t.width)/m,A=(c.fitParent?t.parentNode.clientHeight:t.height)/m,N=P-2*c.paddingX,k=A-2*c.paddingY,E=c.font.match(/\d+(px|em|%)/g)?+c.font.match(/\d+(px|em|%)/g)[0].match(/\d+/g):18,C=0,H=[],B=[],F={x:0,y:0},D=0;o(E),function(){isNaN(c.lineHeight)?-1!==c.lineHeight.toString().indexOf("px")?D=parseInt(c.lineHeight):-1!==c.lineHeight.toString().indexOf("%")&&(D=parseInt(c.lineHeight)/100*E):D=E*c.lineHeight}(),function(){if("string"!=typeof i)throw new TypeError("The second parameter must be a String.");if(isNaN(E))throw new TypeError('Cannot parse "font".');if(isNaN(D))throw new TypeError('Cannot parse "lineHeight".');if("left"!==c.textAlign.toLocaleLowerCase()&&"center"!==c.textAlign.toLocaleLowerCase()&&"right"!==c.textAlign.toLocaleLowerCase())throw new TypeError('Property "textAlign" must be set to either "left", "center", or "right".');if("top"!==c.verticalAlign.toLocaleLowerCase()&&"middle"!==c.verticalAlign.toLocaleLowerCase()&&"bottom"!==c.verticalAlign.toLocaleLowerCase())throw new TypeError('Property "verticalAlign" must be set to either "top", "middle", or "bottom".');if("boolean"!=typeof c.justifyLines)throw new TypeError('Property "justifyLines" must be a Boolean.');if(isNaN(c.paddingX))throw new TypeError('Property "paddingX" must be a Number.');if(isNaN(c.paddingY))throw new TypeError('Property "paddingY" must be a Number.');if("boolean"!=typeof c.fitParent)throw new TypeError('Property "fitParent" must be a Boolean.');if("auto"!==c.lineBreak.toLocaleLowerCase()&&"word"!==c.lineBreak.toLocaleLowerCase())throw new TypeError('Property "lineBreak" must be set to either "auto" or "word".');if("boolean"!=typeof c.sizeToFill)throw new TypeError('Property "sizeToFill" must be a Boolean.');if("boolean"!=typeof c.strokeText)throw new TypeError('Property "strokeText" must be a Boolean.');if("boolean"!=typeof c.renderHDPI)throw new TypeError('Property "renderHDPI" must be a Boolean.');if("none"!==c.textDecoration.toLocaleLowerCase()&&"underline"!==c.textDecoration.toLocaleLowerCase())throw new TypeError('Property "textDecoration" must be set to either "none" or "underline".')}(),function(){if(c.sizeToFill){var e=i.trim().split(/\s+/).length,t=0,r=!1!==c.maxFontSizeToFill;do{if(r){if(!(++t<=c.maxFontSizeToFill))break;n(t)}else n(++t)}while(C<k&&H.join(" ").split(/\s+/).length==e);n(--t)}else a();c.justifyLines&&"auto"===c.lineBreak&&f(),g(),d(),h()}()}"module"in e&&"exports"in module?module.exports=t:e.CanvasTextWrapper=t}(this);