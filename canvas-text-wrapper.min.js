!function(e){function t(t,i,r){"use strict";function o(e){L||(L=w.sizeToFill?u.font.split(/\b\d+px\b/i):w.font.split(/\b\d+px\b/i)),u.font=L[0]+e+"px"+L[1]}function n(e){o(e),D=e*w.lineHeight,a()}function a(){if(w.allowNewLine)for(var e=i.trim().split("\n"),t=0,r=0;t<e.length-1;t++)r+=e[t].trim().split(/\s+/).length,B.push(r);var o=i.trim().split(/\s+/);l(o),s(o),E=H.length*D}function l(e){var t,i,r,o;e.forEach(function(n,a){if(t="",(i=u.measureText(n).width)>N){for(var l=0;u.measureText(t+n[l]).width<=N&&l<n.length;l++)t+=n[l];r=n.slice(0,l),o=n.slice(l),e.splice(a,1,r,o)}})}function s(e){H=[];for(var t=0,i=0;t<e.length;i++)if(H[i]="","auto"===w.lineBreak){if(u.measureText(H[i]+e[t]).width>N)break;for(;u.measureText(H[i]+e[t]).width<=N&&t<e.length;)if(H[i]+=e[t]+" ",t++,w.allowNewLine)for(var r=0;r<B.length;r++)if(B[r]===t){H[++i]="";break}H[i]=H[i].trim()}else H[i]=e[t],t++}function f(){for(var e,t,i,r=0;r<H.length;r++)i=u.measureText(H[r]).width,(!e||i>e)&&(e=i,t=r);var o,n,a,l;for(r=0;r<H.length;r++)if(r!==t&&!((o=H[r].trim().split(/\s+/).length)<=1)){H[r]=H[r].trim().split(/\s+/).join(" "),n=u.measureText(" ").width,a=(e-u.measureText(H[r]).width)/n/(o-1),l="";for(var s=0;s<a;s++)l+=" ";H[r]=H[r].trim().split(" ").join(l)}}function p(e,t,i){var r=u.measureText(e).width;switch(u.textAlign){case"center":t-=r/2;break;case"right":t-=r}u.beginPath(),u.moveTo(t,i),u.lineTo(t+r,i),u.stroke()}function h(){var e=0;z=H.indexOf("\0B7 ");for(var t=0;t<H.length;t++)F.y=parseInt(F.y)+D,-1==z?u.fillText(H[t],F.x,F.y):t<z?u.fillText(H[t],F.x,F.y):(e=u.measureText(H[t]).width>e?u.measureText(H[t]).width:e,j.x=P/2-e/2,u.textAlign="left",u.fillText(H[t],j.x,F.y)),w.strokeText&&u.strokeText(H[t],F.x,F.y),"underline"===w.textDecoration.toLocaleLowerCase()&&p(H[t],F.x,F.y)}function d(){u.textAlign=w.textAlign,"center"==w.textAlign?F.x=P/2:"right"==w.textAlign?F.x=P-w.paddingX:F.x=w.paddingX}function g(){"middle"==w.verticalAlign?F.y=(A-E)/2:"bottom"==w.verticalAlign?F.y=A-E-w.paddingY:F.y=w.paddingY}var x={font:"18px Arial, sans-serif",sizeToFill:!1,maxFontSizeToFill:!1,lineHeight:1,allowNewLine:!0,lineBreak:"auto",textAlign:"left",verticalAlign:"top",justifyLines:!1,paddingX:0,paddingY:0,fitParent:!1,strokeText:!1,renderHDPI:!0,textDecoration:"none"},w={};for(var c in x)w[c]=r.hasOwnProperty(c)?r[c]:x[c];var u=t.getContext("2d");u.font=w.font,u.textBaseline="bottom";var m=1,y="undefined"!=typeof global?global.devicePixelRatio:e.devicePixelRatio;if(w.renderHDPI&&y>1){var T={};for(var c in u)T[c]=u[c];var b=t.width,v=t.height;m=y,t.width=b*m,t.height=v*m,t.style.width=b*m*.5+"px",t.style.height=v*m*.5+"px";for(var c in T)try{u[c]=T[c]}catch(e){}u.scale(m,m)}var L,P=(w.fitParent?t.parentNode.clientWidth:t.width)/m,A=(w.fitParent?t.parentNode.clientHeight:t.height)/m,N=P-2*w.paddingX,k=A-2*w.paddingY,C=w.font.match(/\d+(px|em|%)/g)?+w.font.match(/\d+(px|em|%)/g)[0].match(/\d+/g):18,E=0,H=[],B=[],F={x:0,y:0},D=0,z=-1,j={x:0,y:0};o(C),function(){isNaN(w.lineHeight)?-1!==w.lineHeight.toString().indexOf("px")?D=parseInt(w.lineHeight):-1!==w.lineHeight.toString().indexOf("%")&&(D=parseInt(w.lineHeight)/100*C):D=C*w.lineHeight}(),function(){if("string"!=typeof i)throw new TypeError("The second parameter must be a String.");if(isNaN(C))throw new TypeError('Cannot parse "font".');if(isNaN(D))throw new TypeError('Cannot parse "lineHeight".');if("left"!==w.textAlign.toLocaleLowerCase()&&"center"!==w.textAlign.toLocaleLowerCase()&&"right"!==w.textAlign.toLocaleLowerCase())throw new TypeError('Property "textAlign" must be set to either "left", "center", or "right".');if("top"!==w.verticalAlign.toLocaleLowerCase()&&"middle"!==w.verticalAlign.toLocaleLowerCase()&&"bottom"!==w.verticalAlign.toLocaleLowerCase())throw new TypeError('Property "verticalAlign" must be set to either "top", "middle", or "bottom".');if("boolean"!=typeof w.justifyLines)throw new TypeError('Property "justifyLines" must be a Boolean.');if(isNaN(w.paddingX))throw new TypeError('Property "paddingX" must be a Number.');if(isNaN(w.paddingY))throw new TypeError('Property "paddingY" must be a Number.');if("boolean"!=typeof w.fitParent)throw new TypeError('Property "fitParent" must be a Boolean.');if("auto"!==w.lineBreak.toLocaleLowerCase()&&"word"!==w.lineBreak.toLocaleLowerCase())throw new TypeError('Property "lineBreak" must be set to either "auto" or "word".');if("boolean"!=typeof w.sizeToFill)throw new TypeError('Property "sizeToFill" must be a Boolean.');if("boolean"!=typeof w.strokeText)throw new TypeError('Property "strokeText" must be a Boolean.');if("boolean"!=typeof w.renderHDPI)throw new TypeError('Property "renderHDPI" must be a Boolean.');if("none"!==w.textDecoration.toLocaleLowerCase()&&"underline"!==w.textDecoration.toLocaleLowerCase())throw new TypeError('Property "textDecoration" must be set to either "none" or "underline".')}(),function(){if(w.sizeToFill){var e=i.trim().split(/\s+/).length,t=0,r=!1!==w.maxFontSizeToFill;do{if(r){if(!(++t<=w.maxFontSizeToFill))break;n(t)}else n(++t)}while(E<k&&H.join(" ").split(/\s+/).length==e);n(--t)}else a();w.justifyLines&&"auto"===w.lineBreak&&f(),g(),d(),h()}()}"module"in e&&"exports"in module?module.exports=t:e.CanvasTextWrapper=t}(this);